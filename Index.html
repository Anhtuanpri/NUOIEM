<!DOCTYPE html>  
<html lang="vi">  
<head>  
<meta charset="UTF-8">  
<title>C·ªù Caro Online - VIP</title>  
<meta name="viewport" content="width=device-width, initial-scale=1.0">  
  
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>  
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>  
  
<style>  
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap');  
  
:root{  
  --bg:#0a0e27;  
  --card:rgba(255,255,255,.05);  
  --x:#00ff88;  
  --o:#ff0080;  
  --gold:#ffd700;  
}  
  
*{  
  margin:0;  
  padding:0;  
  box-sizing:border-box;  
}  
  
body{  
  font-family:'Orbitron',system-ui,Arial;  
  color:#fff;  
  text-align:center;  
  background:#0a0e27;  
  min-height:100vh;  
  overflow-x:hidden;  
  position:relative;  
}  
  
/* ANIMATED BACKGROUND */  
body::before{  
  content:'';  
  position:fixed;  
  width:200%;  
  height:200%;  
  top:-50%;  
  left:-50%;  
  z-index:0;  
  background:  
    radial-gradient(circle at 20% 30%, rgba(0,255,136,.15) 0%, transparent 50%),  
    radial-gradient(circle at 80% 70%, rgba(255,0,128,.15) 0%, transparent 50%),  
    radial-gradient(circle at 50% 50%, rgba(255,215,0,.1) 0%, transparent 40%);  
  animation:drift 20s infinite linear;  
}  
  
@keyframes drift{  
  0%{transform:rotate(0deg) scale(1)}  
  50%{transform:rotate(180deg) scale(1.1)}  
  100%{transform:rotate(360deg) scale(1)}  
}  
  
.hidden{display:none!important}  
  
/* CONTAINER */  
#home,#game{  
  max-width:600px;  
  margin:40px auto;  
  padding:30px;  
  background:rgba(10,14,39,.85);  
  backdrop-filter:blur(20px);  
  border-radius:24px;  
  border:2px solid rgba(255,215,0,.3);  
  box-shadow:  
    0 0 40px rgba(255,215,0,.2),  
    inset 0 0 40px rgba(255,215,0,.05);  
  position:relative;  
  z-index:1;  
}  
  
/* TITLE */  
h2{  
  font-size:clamp(24px,5vw,36px);  
  font-weight:900;  
  margin-bottom:30px;  
  background:linear-gradient(135deg,var(--x),var(--gold),var(--o));  
  -webkit-background-clip:text;  
  background-clip:text;  
  -webkit-text-fill-color:transparent;  
  text-shadow:0 0 30px rgba(255,215,0,.5);  
  letter-spacing:2px;  
  animation:glow 3s ease-in-out infinite;  
}  
  
@keyframes glow{  
  0%,100%{filter:brightness(1)}  
  50%{filter:brightness(1.3)}  
}  
  
/* INPUT */  
input,button{  
  padding:15px 20px;  
  margin:10px;  
  border-radius:14px;  
  border:none;  
  font-size:16px;  
  font-family:'Orbitron',sans-serif;  
  transition:all 0.3s cubic-bezier(0.4,0,0.2,1);  
}  
  
input{  
  width:90%;  
  max-width:450px;  
  background:rgba(255,255,255,.08);  
  border:2px solid rgba(255,215,0,.2);  
  color:#fff;  
  backdrop-filter:blur(10px);  
}  
  
input:focus{  
  outline:none;  
  border-color:var(--gold);  
  box-shadow:0 0 20px rgba(255,215,0,.4);  
  transform:scale(1.02);  
}  
  
input::placeholder{  
  color:rgba(255,255,255,.5);  
}  
  
button{  
  background:linear-gradient(135deg,var(--x),var(--gold));  
  color:#000;  
  font-weight:700;  
  cursor:pointer;  
  border:2px solid transparent;  
  text-transform:uppercase;  
  letter-spacing:1px;  
  position:relative;  
  overflow:hidden;  
}  
  
button::before{  
  content:'';  
  position:absolute;  
  top:50%;  
  left:50%;  
  width:0;  
  height:0;  
  border-radius:50%;  
  background:rgba(255,255,255,.3);  
  transform:translate(-50%,-50%);  
  transition:width 0.6s,height 0.6s;  
}  
  
button:hover::before{  
  width:300px;  
  height:300px;  
}  
  
button:hover{  
  transform:translateY(-3px);  
  box-shadow:0 10px 30px rgba(255,215,0,.5);  
}  
  
button:active{  
  transform:translateY(-1px);  
}  
  
.btn-clear{  
  background:linear-gradient(135deg,#ff0080,#ff4040);  
  font-size:14px;  
  padding:12px 24px;  
}  
  
/* VERSUS */  
#versus{  
  display:flex;  
  justify-content:space-around;  
  align-items:center;  
  gap:20px;  
  margin:20px 0;  
  padding:20px;  
  background:rgba(255,215,0,.05);  
  border-radius:16px;  
  border:1px solid rgba(255,215,0,.2);  
}  
  
.vs-player{  
  display:flex;  
  flex-direction:column;  
  align-items:center;  
  gap:10px;  
  flex:1;  
}  
  
/* AVATAR + FRAME */  
.avatar-wrap{  
  position:relative;  
  width:90px;  
  height:90px;  
  filter:drop-shadow(0 0 20px rgba(255,215,0,.6));  
}  
  
.avatar{  
  position:absolute;  
  top:50%;  
  left:50%;  
  transform:translate(-50%,-50%);  
  width:70px;  
  height:70px;  
  object-fit:cover;  
  border-radius:50%;  
  clip-path:circle(50%);  
  z-index:1;  
  background:#1e293b;  
  border:3px solid rgba(255,215,0,.3);  
}  
  
.frame{  
  position:absolute;  
  top:0;  
  left:0;  
  width:100%;  
  height:100%;  
  z-index:2;  
  pointer-events:none;  
  object-fit:contain;  
  animation:rotate 20s linear infinite;  
}  
  
@keyframes rotate{  
  from{transform:rotate(0deg)}  
  to{transform:rotate(360deg)}  
}  
  
#sword{  
  font-size:40px;  
  animation:pulse 2s ease-in-out infinite;  
}  
  
@keyframes pulse{  
  0%,100%{transform:scale(1)}  
  50%{transform:scale(1.2)}  
}  
  
.vs-player strong{  
  font-size:16px;  
  font-weight:700;  
  text-shadow:0 0 10px currentColor;  
}  
  
/* BOARD */  
#board{  
  display:grid;  
  gap:4px;  
  max-width:550px;  
  margin:20px auto;  
  padding:15px;  
  background:rgba(0,0,0,.3);  
  border-radius:16px;  
  border:2px solid rgba(255,215,0,.2);  
}  
  
.cell{  
  aspect-ratio:1;  
  background:linear-gradient(135deg,#1a1f3a,#0f1729);  
  border-radius:8px;  
  display:flex;  
  align-items:center;  
  justify-content:center;  
  font-size:clamp(16px,4vw,24px);  
  font-weight:900;  
  cursor:pointer;  
  transition:all 0.3s;  
  border:1px solid rgba(255,215,0,.1);  
}  
  
.cell:hover{  
  background:linear-gradient(135deg,#2a3f5a,#1f2d4a);  
  transform:scale(1.1);  
  box-shadow:0 0 15px rgba(255,215,0,.4);  
}  
  
.cell.X{  
  color:var(--x);  
  text-shadow:0 0 15px var(--x);  
  animation:pop 0.3s cubic-bezier(0.68,-0.55,0.265,1.55);  
}  
  
.cell.O{  
  color:var(--o);  
  text-shadow:0 0 15px var(--o);  
  animation:pop 0.3s cubic-bezier(0.68,-0.55,0.265,1.55);  
}  
  
@keyframes pop{  
  0%{transform:scale(0)}  
  70%{transform:scale(1.2)}  
  100%{transform:scale(1)}  
}  
  
/* STATUS */  
#status{  
  margin:20px 0;  
  font-weight:700;  
  font-size:clamp(16px,3vw,20px);  
  padding:15px;  
  border-radius:12px;  
  background:rgba(255,215,0,.1);  
  border:2px solid rgba(255,215,0,.3);  
  text-transform:uppercase;  
  letter-spacing:1px;  
  animation:statusPulse 2s ease-in-out infinite;  
}  
  
@keyframes statusPulse{  
  0%,100%{box-shadow:0 0 10px rgba(255,215,0,.3)}  
  50%{box-shadow:0 0 25px rgba(255,215,0,.6)}  
}  
  
/* TIMER */  
#timers{  
  display:flex;  
  justify-content:space-between;  
  gap:15px;  
  margin-top:20px;  
}  
  
.timer{  
  flex:1;  
  padding:12px;  
  border-radius:12px;  
  background:rgba(0,0,0,.4);  
  border:2px solid rgba(255,215,0,.2);  
  font-weight:700;  
  font-size:clamp(14px,2.5vw,16px);  
  backdrop-filter:blur(10px);  
}  
  
#turnTimer{  
  color:#facc15;  
  text-shadow:0 0 10px #facc15;  
}  
  
#matchTimer{  
  color:#60a5fa;  
  text-shadow:0 0 10px #60a5fa;  
}  
  
/* PREVIEW */  
#previewWrap{  
  margin:20px auto;  
  display:none;  
  animation:fadeIn 0.5s;  
}  
  
@keyframes fadeIn{  
  from{opacity:0;transform:scale(0.9)}  
  to{opacity:1;transform:scale(1)}  
}  
  
.preview-avatar-wrap{  
  position:relative;  
  width:90px;  
  height:90px;  
  margin:0 auto 15px;  
  filter:drop-shadow(0 0 25px rgba(0,255,136,.6));  
}  
  
#previewAvatar{  
  position:absolute;  
  top:50%;  
  left:50%;  
  transform:translate(-50%,-50%);  
  width:70px;  
  height:70px;  
  object-fit:cover;  
  border-radius:50%;  
  clip-path:circle(50%);  
  border:3px solid var(--x);  
  z-index:1;  
}  
  
.preview-frame{  
  position:absolute;  
  top:0;  
  left:0;  
  width:100%;  
  height:100%;  
  z-index:2;  
  pointer-events:none;  
  animation:rotate 15s linear infinite;  
}  
  
/* RESPONSIVE */  
@media(max-width:600px){  
  #home,#game{  
    margin:20px 10px;  
    padding:20px;  
  }  
    
  .avatar-wrap,.preview-avatar-wrap{  
    width:75px;  
    height:75px;  
  }  
    
  .avatar,#previewAvatar{  
    width:60px;  
    height:60px;  
  }  
    
  #sword{font-size:32px}  
}  
</style>  
</head>  
  
<body>  
  
<h2>‚ö° C·ªú CARO VIP ‚ö°</h2>  
  
<div id="home">  
  <input id="inpName" placeholder="üë§ T√™n Ki·ªán T∆∞·ªõng" autocomplete="off">  
  <input id="inpAvatar" placeholder="üñºÔ∏è Link Avatar (jpg/png/gif)" autocomplete="off">  
    
  <div id="previewWrap">  
    <div class="preview-avatar-wrap">  
      <img id="previewAvatar" src="">  
      <img class="preview-frame" src="https://i.postimg.cc/FFqqqbzz/khung-vip-303.gif">  
    </div>  
    <p style="font-size:14px;color:var(--x);font-weight:700;">‚úÖ PREVIEW AVATAR</p>  
  </div>  
    
  <input id="inpRoom" placeholder="üéÆ M√£ Ph√≤ng (6 k√Ω t·ª±)" maxlength="6" autocomplete="off">  
    
  <button id="btnJoin">üöÄ V√ÄO PH√íNG</button>  
    
  <button class="btn-clear" id="btnClearStorage">üóëÔ∏è X√ìA D·ªÆ LI·ªÜU</button>  
</div>  
  
<div id="game" class="hidden">  
  <div id="versus">  
    <div class="vs-player" id="playerX"></div>  
    <div id="sword">‚öîÔ∏è</div>  
    <div class="vs-player" id="playerO"></div>  
  </div>  
  
  <div id="board"></div>  
  <div id="status"></div>  
  
  <div id="timers">  
    <div class="timer" id="turnTimer">‚è± L∆∞·ª£t: ‚Äî</div>  
    <div class="timer" id="matchTimer">‚åõ V√°n: 15:00</div>  
  </div>  
  
  <button class="btn-clear" style="margin-top:20px" id="btnLeave">üö™ R·ªúI PH√íNG</button>  
</div>  
  
<script>  
/* ===== CONFIG ===== */  
const SIZE = 15;  
const TURN_LIMIT = 15000;  
const MATCH_LIMIT = 15 * 60 * 1000;  
  
/* üëâ LINK KHUNG VIP */  
const FRAME_GIF = "https://i.postimg.cc/FFqqqbzz/khung-vip-303.gif";  
  
/* ===== FIREBASE ===== */  
firebase.initializeApp({  
  apiKey:"AIzaSyBdKC3vCBjHhsakrE1hUYg-2_Vi9JYX3vk",  
  databaseURL:"https://noitu-7dca6-default-rtdb.asia-southeast1.firebasedatabase.app",  
  projectId:"noitu-7dca6"  
});  
const db = firebase.database();  
  
/* ===== DOM ===== */  
const home=document.getElementById("home");  
const game=document.getElementById("game");  
const boardDiv=document.getElementById("board");  
const statusEl=document.getElementById("status");  
const turnTimerEl=document.getElementById("turnTimer");  
const matchTimerEl=document.getElementById("matchTimer");  
const pX=document.getElementById("playerX");  
const pO=document.getElementById("playerO");  
  
const inpName=document.getElementById("inpName");  
const inpAvatar=document.getElementById("inpAvatar");  
const inpRoom=document.getElementById("inpRoom");  
const previewWrap=document.getElementById("previewWrap");  
const previewAvatar=document.getElementById("previewAvatar");  
  
/* ===== STATE ===== */  
let myRole="", roomId="";  
let uid=localStorage.uid||(localStorage.uid=Math.random().toString(36));  
let timerInt=null;  
  
/* ===== LOAD SAVED DATA ===== */  
window.onload = function() {  
  const savedName = localStorage.getItem('playerName_'+uid);  
  const savedAvatar = localStorage.getItem('playerAvatar_'+uid);  
    
  if(savedName) inpName.value = savedName;  
  if(savedAvatar) {  
    inpAvatar.value = savedAvatar;  
    previewAvatar.src = savedAvatar;  
    previewWrap.style.display = 'block';  
  }  
};  
  
/* ===== PREVIEW AVATAR ===== */  
inpAvatar.oninput = function() {  
  const url = inpAvatar.value.trim();  
  if(url) {  
    previewAvatar.src = url;  
    previewWrap.style.display = 'block';  
  } else {  
    previewWrap.style.display = 'none';  
  }  
};  
  
/* ===== CLEAR STORAGE ===== */  
document.getElementById("btnClearStorage").onclick = function() {  
  if(!confirm("‚ö†Ô∏è X√≥a t√™n & ·∫£nh ƒë√£ l∆∞u?")) return;  
    
  localStorage.removeItem('playerName_'+uid);  
  localStorage.removeItem('playerAvatar_'+uid);  
    
  inpName.value = '';  
  inpAvatar.value = '';  
  previewWrap.style.display = 'none';  
    
  alert("‚úÖ ƒê√£ x√≥a!");  
};  
  
/* ===== JOIN ===== */  
document.getElementById("btnJoin").onclick = function() {  
  const name = inpName.value.trim();  
  const avatar = inpAvatar.value.trim();  
  roomId = inpRoom.value.trim();  
    
  if(!name || !roomId) return alert("‚ö†Ô∏è Nh·∫≠p ƒë·ªß t√™n v√† m√£ ph√≤ng!");  
  if(roomId.length !== 6) return alert("‚ö†Ô∏è M√£ ph√≤ng ph·∫£i ƒë·ªß 6 k√Ω t·ª±!");  
  
  localStorage.setItem('playerName_'+uid, name);  
  if(avatar) localStorage.setItem('playerAvatar_'+uid, avatar);  
  
  home.classList.add("hidden");  
  game.classList.remove("hidden");  
  
  db.ref("rooms/"+roomId).transaction(r=>{  
    if(!r){  
      r={  
        board:Array(SIZE*SIZE).fill(""),  
        players:{},  
        turn:"X",  
        startTime:firebase.database.ServerValue.TIMESTAMP,  
        turnTime:firebase.database.ServerValue.TIMESTAMP,  
        winner:null  
      };  
    }  
  
    if(r.players.X && r.players.X.id===uid){   
      myRole="X";   
      r.players.X.name = name;  
      r.players.X.avatar = avatar;  
      return r;   
    }  
    if(r.players.O && r.players.O.id===uid){   
      myRole="O";   
      r.players.O.name = name;  
      r.players.O.avatar = avatar;  
      return r;   
    }  
  
    if(!r.players.X){   
      r.players.X = {name, avatar, id:uid};   
      myRole="X";   
    }  
    else if(!r.players.O){   
      r.players.O = {name, avatar, id:uid};   
      myRole="O";   
    }  
  
    return r;  
  });  
  
  listen();  
};  
  
/* ===== LEAVE ROOM ===== */  
document.getElementById("btnLeave").onclick = function() {  
  if(confirm("R·ªùi ph√≤ng?")){  
    clearInterval(timerInt);  
    db.ref("rooms/"+roomId).off();  
      
    if(myRole){  
      db.ref("rooms/"+roomId+"/players/"+myRole).remove();  
    }  
      
    game.classList.add("hidden");  
    home.classList.remove("hidden");  
    myRole = "";  
    roomId = "";  
  }  
};  
  
/* ===== RENDER ===== */  
function renderPlayer(div, p, s){  
  if(!p){   
    div.innerHTML="<strong>‚ùì Ch·ªù ng∆∞·ªùi ch∆°i...</strong>";   
    return;   
  }  
    
  const avatarHTML = p.avatar   
    ? `<img class="avatar" src="${p.avatar}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex';">  
       <div class="avatar" style="background:#1e293b;display:none;align-items:center;justify-content:center;font-size:28px;">?</div>`  
    : `<div class="avatar" style="background:#1e293b;display:flex;align-items:center;justify-content:center;font-size:28px;">?</div>`;  
    
  div.innerHTML=`  
    <div class="avatar-wrap">  
      ${avatarHTML}  
      <img class="frame" src="${FRAME_GIF}">  
    </div>  
    <strong style="color:${s==="X"?"var(--x)":"var(--o)"}">${p.name}</strong>  
  `;  
}  
  
function renderBoard(board){  
  boardDiv.innerHTML="";  
  boardDiv.style.gridTemplateColumns=`repeat(${SIZE},1fr)`;  
  board.forEach((v,i)=>{  
    const d=document.createElement("div");  
    d.className="cell "+(v||"");  
    d.textContent=v||"";  
    d.onclick=()=>play(i);  
    boardDiv.appendChild(d);  
  });  
}  
  
/* ===== TIMER ===== */  
function startTimers(r){  
  clearInterval(timerInt);  
  
  if(typeof r.startTime!=="number" || typeof r.turnTime!=="number"){  
    turnTimerEl.textContent="‚è± L∆∞·ª£t: ‚Äî";  
    matchTimerEl.textContent="‚åõ V√°n: 15:00";  
    return;  
  }  
  
  timerInt=setInterval(()=>{  
    if(r.winner){   
      clearInterval(timerInt);   
      return;   
    }  
      
    const now=Date.now();  
  
    const left=TURN_LIMIT-(now-r.turnTime);  
    if(r.turn===myRole){  
      const sec = Math.max(0,Math.ceil(left/1000));  
      turnTimerEl.textContent="‚è± L∆∞·ª£t: "+sec+"s";  
      turnTimerEl.style.color = sec <= 5 ? '#ff0040' : '#facc15';  
    }else{  
      turnTimerEl.textContent="‚è± ƒê·ª£i ƒë·ªëi th·ªß...";  
      turnTimerEl.style.color = '#facc15';  
    }  
  
    if(left<=0 && !r.winner){  
      db.ref("rooms/"+roomId+"/winner").set(r.turn==="X"?"O":"X");  
      clearInterval(timerInt);  
      return;  
    }  
  
    const mleft=MATCH_LIMIT-(now-r.startTime);  
    const m=Math.max(0,Math.floor(mleft/60000));  
    const s=Math.max(0,Math.floor((mleft%60000)/1000));  
    matchTimerEl.textContent=`‚åõ V√°n: ${m}:${s.toString().padStart(2,"0")}`;  
  
    if(mleft<=0 && !r.winner){  
      db.ref("rooms/"+roomId+"/winner").set("draw");  
      clearInterval(timerInt);  
    }  
  },500);  
}  
  
/* ===== LISTEN ===== */  
function listen(){  
  db.ref("rooms/"+roomId).on("value",snap=>{  
    const r=snap.val();   
    if(!r) return;  
      
    renderPlayer(pX, r.players.X, "X");  
    renderPlayer(pO, r.players.O, "O");  
    renderBoard(r.board);  
    startTimers(r);  
  
    if(r.winner){  
      if(r.winner==="draw"){  
        statusEl.textContent = "ü§ù HO√Ä!";  
        statusEl.style.background = "rgba(100,100,100,.3)";  
      }else{  
        const winnerName = r.players[r.winner]?.name || r.winner;  
        statusEl.textContent = `üèÜ ${winnerName} TH·∫ÆNG!`;  
        statusEl.style.background = "rgba(255,215,0,.3)";  
      }  
    }else{  
      if(r.turn===myRole){  
        statusEl.textContent = "üëâ L∆Ø·ª¢T C·ª¶A B·∫†N!";  
        statusEl.style.background = "rgba(0,255,136,.2)";  
      }else{  
        statusEl.textContent = "‚è≥ ƒê·ª¢I ƒê·ªêI TH·ª¶...";  
        statusEl.style.background = "rgba(255,215,0,.1)";  
      }  
    }  
  });  
}  
  
/* ===== PLAY ===== */  
function play(i){  
  db.ref("rooms/"+roomId).once("value",snap=>{  
    const r=snap.val();  
    if(!r||r.turn!==myRole||r.board[i]||r.winner) return;  
      
    r.board[i]=myRole;  
      
    if(checkWin(r.board, i)){  
      db.ref("rooms/"+roomId).update({  
        board:r.board,  
        winner:myRole  
      });  
      return;  
    }  
      
    if(!r.board.includes("")){  
      db.ref("rooms/"+roomId).update({  
        board:r.board,  
        winner:"draw"  
      });  
      return;  
    }  
      
    db.ref("rooms/"+roomId).update({  
      board:r.board,  
      turn:myRole==="X"?"O":"X",  
      turnTime:firebase.database.ServerValue.TIMESTAMP  
    });  
  });  
}  
  
/* ===== CHECK WIN ===== */  
function checkWin(board, pos){  
  const row = Math.floor(pos/SIZE);  
  const col = pos%SIZE;  
  const val = board[pos];  
    
  const dirs = [[0,1], [1,0], [1,1], [1,-1]];  
    
  for(let [dr,dc] of dirs){  
    let count = 1;  
      
    for(let i=1; i<5; i++){  
      const r = row + dr*i;  
      const c = col + dc*i;  
      if(r<0||r>=SIZE||c<0||c>=SIZE) break;  
      if(board[r*SIZE+c]!==val) break;  
      count++;  
    }  
      
    for(let i=1; i<5; i++){  
      const r = row - dr*i;  
      const c = col - dc*i;  
      if(r<0||r>=SIZE||c<0||c>=SIZE) break;  
      if(board[r*SIZE+c]!==val) break;  
      count++;  
    }  
      
    if(count>=5) return true;  
  }  
    
  return false;  
}  
</script>  
  
</body>  
</html>  
