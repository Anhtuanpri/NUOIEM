<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Caro Online</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
  background:#0f172a;
  color:white;
  font-family:Arial;
  text-align:center;
}
#board{
  display:grid;
  grid-template-columns: repeat(3, 100px);
  gap:10px;
  justify-content:center;
  margin:20px auto;
}
.cell{
  width:100px;
  height:100px;
  background:#1e293b;
  font-size:48px;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
}
</style>
</head>

<body>

<h2>‚≠ï‚ùå Caro Online</h2>
<p id="info"></p>
<div id="board"></div>

<script>
// ===== FIREBASE (C·ª¶A B·∫†N) =====
firebase.initializeApp({
  apiKey: "AIzaSyBdKC3vCBjHhsakrE1hUYg-2_Vi9JYX3vk",
  databaseURL: "https://noitu-7dca6-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "noitu-7dca6"
});
const db = firebase.database();
// =============================

// üëâ room l·∫•y tr·ª±c ti·∫øp t·ª´ LINK
let room = location.hash.replace("#","");
if(!room){
  room = Math.random().toString(36).slice(2,7);
  location.hash = room;
}

document.getElementById("info").innerText =
  "Link ph√≤ng: " + location.href;

let myRole = "X";

// x√°c ƒë·ªãnh X hay O
db.ref("rooms/"+room+"/players").once("value",snap=>{
  if(snap.exists()) myRole = "O";
  db.ref("rooms/"+room+"/players/"+myRole).set(true);
});

const boardDiv = document.getElementById("board");
const cells = Array(9).fill("");

for(let i=0;i<9;i++){
  const d = document.createElement("div");
  d.className="cell";
  d.onclick = ()=> play(i);
  boardDiv.appendChild(d);
}

function play(i){
  if(cells[i]) return;
  cells[i] = myRole;
  sync();
}

function sync(){
  db.ref("rooms/"+room+"/board").set(cells);
}

db.ref("rooms/"+room+"/board").on("value",snap=>{
  if(!snap.val()) return;
  snap.val().forEach((v,i)=>{
    cells[i]=v;
    boardDiv.children[i].innerText=v||"";
  });
});
</script>

</body>
</html>
